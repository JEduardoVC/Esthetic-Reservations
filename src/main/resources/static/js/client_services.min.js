const cita={userId:"",branchId:"",fecha:"",hora:"",servicios:[]};let contador=0,page=1;const userId=sessionStorage.getItem("userId"),branchId=sessionStorage.getItem("branchId"),myHeaders=new Headers;async function showInfoClient(){const e=await fetch("/api/user/"+userId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),n=document.querySelector("#nombre-usuario"),{name:a,lastName:o}=t;n.textContent=`${a} ${o}`}async function showInfoBranch(){const e=await fetch("/api/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),{branchName:n}=t;document.querySelector("#nombre-branch").textContent=""+n}async function showServices(){try{const e=await fetch("/api/owner/servicios/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json();if(0==t.content){const e=document.querySelector("#servicios"),t=document.createElement("P");t.textContent="No hay servicios registrados",t.className="sin-contenido",e.appendChild(t)}t.content.forEach(e=>{const{id:t,service_name:n,duration:a,price:o}=e,c=document.querySelector("#servicios"),s=document.createElement("div");s.className="servicio",s.innerHTML=`\n                <p class="titulo">${n}</p>\n                <p>Duracion aproximada: ${a} min</p>\n                <p>Precio: <span>$${o}</span></p>\n            `,c.appendChild(s),s.addEventListener("click",(function(){if(s.classList.contains("servicio-seleccionado"))s.classList.remove("servicio-seleccionado"),removeService(t);else{s.classList.add("servicio-seleccionado");addService({id:parseInt(t),name:n,precio:o})}}))})}catch(e){console.error(e)}}function removeService(e){const{servicios:t}=cita;cita.servicios=t.filter(t=>t.id!==e)}function addService(e){const{servicios:t}=cita;cita.servicios=[...t,e]}function nextPage(){const e=document.querySelector("#siguiente");null!=e&&e.addEventListener("click",()=>{page++,pagerButtons()})}function previousPage(){const e=document.querySelector("#anterior");null!=e&&e.addEventListener("click",()=>{page--,pagerButtons()})}function pagerButtons(){const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===page?t.classList.add("ocultar"):2===page?(t.classList.remove("ocultar"),e.classList.remove("ocultar")):(e.classList.add("ocultar"),t.classList.remove("ocultar"),mostrarResumen()),mostrarSeccion()}function mostrarSeccion(){const e=document.querySelector(".mostrar-seccion");e&&e.classList.remove("mostrar-seccion");document.querySelector("#paso-"+page).classList.add("mostrar-seccion")}function backDateDisabled(){const e=document.querySelector("#fecha"),t=new Date,n=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()+1}`;e.min=n}async function horaCita(){const e=await fetch("/api/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),n=document.querySelector("#hora");n.addEventListener("input",e=>{const a=e.target.value,o=a.split(":"),{scheduleOpen:c,scheduleClose:s}=t;o[0]>=c.split(":")[0]&&o[1]>=c.split(":")[1]?cita.hora=a:(console.error("Es muy temprano"),setTimeout(()=>{n.value=""},3e3))})}function fechaCita(){const e=document.querySelector("#fecha");e.addEventListener("input",t=>{const n=new Date(t.target.value).getUTCDay();[0,6].includes(n)?(t.preventDefault(),e.value="",mostrarAlerta("Fines de Semana no son permitidos","error")):cita.fecha=e.value})}async function mostrarResumen(){cita.userId=userId,cita.branchId=branchId;const{servicios:e,fecha:t,hora:n}=cita,a=document.querySelector("#resumen");for(;a.firstChild;)a.removeChild(a.firstChild);if(Object.values(cita).includes("")){const e=document.createElement("P");return e.textContent="Faltan datos de Servicios, hora, fecha",e.classList.add("invalidar-cita"),void a.appendChild(e)}const o=document.createElement("H1");o.textContent="Resumen de cita";const c=await fetch("/api/user/"+userId,{method:"GET",headers:myHeaders,redirect:"follow"}),s=await c.json(),{name:r,lastName:i}=s,d=document.createElement("P");d.innerHTML="<span>Fecha:</span> "+t;const l=document.createElement("P");l.innerHTML="<span>Hora:</span> "+n;const u=document.createElement("DIV");u.classList.add("resumen-servicios");const m=document.createElement("H3");m.textContent="Resumen de Servicios",u.appendChild(m);let p=0;e.forEach(async e=>{const{id:t}=e,n=await fetch("/api/owner/servicios/"+t,{method:"GET",headers:myHeaders,redirect:"follow"}),a=await n.json(),{service_name:o,price:c}=a,s=document.createElement("DIV");s.classList.add("contenedor-servicio");const r=document.createElement("P");r.textContent=o;const i=document.createElement("P");i.textContent="$"+c,i.classList.add("precio"),p+=c,s.appendChild(r),s.appendChild(i),u.appendChild(s)}),a.appendChild(o),a.appendChild(d),a.appendChild(l),a.appendChild(u);const h=document.createElement("P");h.classList.add("total"),setTimeout(()=>{h.innerHTML="<span>Total a Pagar:  </span> $"+p},50),a.appendChild(h);const f=document.createElement("button");f.classList.add("btn-principal"),f.classList.add("btn-reservar"),f.textContent="Reservar cita",f.onclick=makeAnAppointment,a.appendChild(f)}async function makeAnAppointment(){const{branchId:e,fecha:t,hora:a,servicios:o,userId:c}=cita,s=[];o.forEach(e=>{s.push(e.id)}),myHeaders.append("Content-Type","application/json");const r=await fetch("/api/appointment/guardar",{method:"POST",headers:myHeaders,body:JSON.stringify({id_branch:parseInt(e),appointment_date:t,appointment_time:"00:"+a,id_service:s,id_client:parseInt(c)}),redirect:"follow"}),i=await r.text();if(i){console.log(i);const e=new QRious({element:document.querySelector("#qr"),value:"{id_cita: 1}",size:200,backgroundAlpha:0,foreground:"#000000",level:"H"}).element.src.split(",")[1];for(bstr=atob(e),n=bstr.length,u8arr=new Uint8Array(n);n--;)u8arr[n]=bstr.charCodeAt(n);const t=new File(u8arr,"qr.png"),a=document.createElement("input");a.type="file",a.accept="image/*",a.files.item=t,QRCode=a.files[0]}}myHeaders.append("Authorization","Bearer "+sessionStorage.getItem("token")),document.addEventListener("DOMContentLoaded",(function(){showInfoClient(),showInfoBranch(),showServices(),mostrarSeccion(),nextPage(),previousPage(),pagerButtons(),backDateDisabled(),horaCita(),fechaCita()}));
//# sourceMappingURL=client_services.js.map
