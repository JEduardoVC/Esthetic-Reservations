const cita={userId:"",branchId:"",fecha:"",hora:"",servicios:[]},carrito={userId:"",branchId:"",productos:[]};let contador=0,page=1,cantidad=0;const userId=sessionStorage.getItem("userId"),branchId=sessionStorage.getItem("branchId"),myHeaders=new Headers;async function showInfoClient(){const e=await fetch("/api/user/"+userId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),n=document.querySelector("#nombre-usuario"),{name:a,lastName:o}=t;n.textContent=`${a} ${o}`}async function showInfoBranch(){const e=await fetch("/api/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),{branchName:n}=t;document.querySelector("#nombre-branch").textContent=""+n}async function showServices(){try{const e=await fetch("/api/owner/servicios/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json();if(0==t.content){const e=document.querySelector("#servicios"),t=document.createElement("P");t.textContent="No hay servicios registrados",t.className="sin-contenido",e.appendChild(t)}t.content.forEach(e=>{const{id:t,service_name:n,duration:a,price:o}=e,c=document.querySelector("#servicios"),r=document.createElement("div");r.className="servicio",r.innerHTML=`\n                <p class="titulo">${n}</p>\n                <p>Duracion aproximada: ${a} min</p>\n                <p>Precio: <span>$${o}</span></p>\n            `,c.appendChild(r),r.addEventListener("click",(function(){if(r.classList.contains("servicio-seleccionado"))r.classList.remove("servicio-seleccionado"),removeService(t);else{r.classList.add("servicio-seleccionado");addService({id:parseInt(t)})}}))})}catch(e){console.error(e)}}async function showInventory(){const e=await fetch("/api/owner/inventario/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json();if(0==t.content){const e=document.createElement("div"),t=document.createElement("P");t.textContent="No hay inventario en esta sucursal",t.className="sin-contenido",e.appendChild(t)}else{const e=document.querySelector("#products"),n=document.createElement("div");n.classList.add("show-inventario"),t.content.forEach(e=>{const{id:t,imagen:a,inventory_name:o,price:c,store:r}=e,s=document.createElement("div");s.className="producto",s.innerHTML=`\n                <p class="img-producto">${a}</p>\n                <p class="titulo">Producto: ${o}</p>\n                <p>Precio: <span>$${c}</span></p>\n                <p>Cantidad: <span>${r}</span></p>\n            `,n.appendChild(s),s.addEventListener("click",(function(){if(s.classList.contains("producto-seleccionado"))s.classList.remove("producto-seleccionado"),removeProduct(t);else{s.classList.add("producto-seleccionado");addProduct({id:parseInt(t)})}}))}),e.appendChild(n)}}function removeService(e){const{servicios:t}=cita;cita.servicios=t.filter(t=>t.id!==e)}function addService(e){const{servicios:t}=cita;cita.servicios=[...t,e]}function removeProduct(e){const{productos:t}=carrito;carrito.productos=t.filter(t=>t.id!==e)}function addProduct(e){const{productos:t}=carrito;carrito.productos=[...t,e]}function nextPage(){const e=document.querySelector("#siguiente");null!=e&&e.addEventListener("click",()=>{page++,pagerButtons()})}function previousPage(){const e=document.querySelector("#anterior");null!=e&&e.addEventListener("click",()=>{page--,pagerButtons()})}function pagerButtons(){const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===page?t.classList.add("ocultar"):2===page?(t.classList.remove("ocultar"),e.classList.remove("ocultar")):3===page?(t.classList.remove("ocultar"),e.classList.remove("ocultar"),selectQuantity()):4===page?(t.classList.remove("ocultar"),e.classList.remove("ocultar")):(e.classList.add("ocultar"),t.classList.remove("ocultar"),showSummary()),mostrarSeccion()}function mostrarSeccion(){const e=document.querySelector(".mostrar-seccion");e&&e.classList.remove("mostrar-seccion");document.querySelector("#paso-"+page).classList.add("mostrar-seccion")}function backDateDisabled(){const e=document.querySelector("#fecha"),t=new Date,n=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()+1}`;e.min=n}async function horaCita(){const e=await fetch("/api/branch/"+branchId,{method:"GET",headers:myHeaders,redirect:"follow"}),t=await e.json(),n=document.querySelector("#hora");n.addEventListener("input",e=>{const a=e.target.value,o=a.split(":"),{scheduleOpen:c,scheduleClose:r}=t;o[0]>=c.split(":")[0]&&o[1]>=c.split(":")[1]?cita.hora=a:(console.error("Es muy temprano"),setTimeout(()=>{n.value=""},3e3))})}function fechaCita(){const e=document.querySelector("#fecha");e.addEventListener("input",t=>{const n=new Date(t.target.value).getUTCDay();[0,6].includes(n)?(t.preventDefault(),e.value="",mostrarAlerta("Fines de Semana no son permitidos","error")):cita.fecha=e.value})}function showSummary(){cita.userId=userId,cita.branchId=branchId,carrito.userId=userId,carrito.branchId=branchId;const{servicios:e,fecha:t,hora:n}=cita,{productos:a}=carrito,o=document.querySelector("#resumen");for(;o.firstChild;)o.removeChild(o.firstChild);if(Object.values(cita).includes("")){const e=document.createElement("P");return e.textContent="Faltan datos de Servicios, hora, fecha",e.classList.add("invalidar-cita"),void o.appendChild(e)}if(0==carrito.productos.length){const e=document.createElement("P");return e.textContent="Falta seleccionar algun producto",e.classList.add("invalidar-carrito"),void o.appendChild(e)}const c=document.createElement("H1");c.textContent="Resumen de cita";const r=document.createElement("P");r.innerHTML="<span>Fecha:</span> "+t;const s=document.createElement("P");s.innerHTML="<span>Hora:</span> "+n;const i=document.createElement("DIV");i.classList.add("resumen-servicios");const d=document.createElement("H3");d.textContent="Resumen de Servicios",i.appendChild(d),cantidad=0,e.forEach(async e=>{const{id:t}=e,n=await fetch("/api/owner/servicios/"+t,{method:"GET",headers:myHeaders,redirect:"follow"}),a=await n.json(),{service_name:o,price:c}=a,r=document.createElement("DIV");r.classList.add("contenedor-servicio");const s=document.createElement("P");s.textContent=o;const d=document.createElement("P");d.textContent="$"+c,d.classList.add("precio"),cantidad+=c,r.appendChild(s),r.appendChild(d),i.appendChild(r)}),o.appendChild(c),o.appendChild(r),o.appendChild(s),o.appendChild(i);const l=document.createElement("H3");l.textContent="Resumen del Carrito";const u=document.createElement("DIV");u.classList.add("resumen-Productos"),u.appendChild(l);let m=1;a.forEach(async e=>{const{id:t}=e,n=await fetch("/api/owner/inventario/"+t,{method:"GET",headers:myHeaders,redirect:"follow"}),a=await n.json(),{inventory_name:o,price:c}=a,r=document.createElement("DIV");r.classList.add("contenedor-producto");const s=document.createElement("P");s.textContent=o;const i=document.createElement("P");i.textContent="$"+c,i.classList.add("precio"),r.appendChild(s),r.appendChild(i);const d=document.createElement("div");d.classList.add("contenedor-precio");const l=document.querySelector("#quantity_product_"+m),p=document.createElement("p");p.textContent="Cantidad seleccionada: "+l.value;const h=document.createElement("p");h.textContent="Subtotal: "+c*l.value,cantidad+=c*l.value,d.appendChild(p),d.appendChild(h),u.appendChild(r),u.appendChild(d),m++});const p=pay();o.appendChild(u),o.appendChild(p),cantidad=0;const h=document.createElement("button");h.classList.add("btn-principal"),h.classList.add("btn-reservar"),h.textContent="Realizar compra",h.onclick=makeAnAppointment,o.appendChild(h)}async function selectQuantity(){const e=document.querySelector("#num_products");for(;e.firstChild;)e.removeChild(e.firstChild);let t=1;carrito.productos.forEach(async n=>{const{id:a}=n,o=await fetch("/api/owner/inventario/"+a,{method:"GET",headers:myHeaders,redirect:"follow"}),c=await o.json(),{inventory_name:r}=c,s=document.createElement("div");s.classList.add("list-product");const i=document.createElement("p");i.textContent=r;const d=document.createElement("input");d.type="number",d.id="quantity_product_"+t,s.appendChild(i),s.appendChild(d),e.appendChild(s),t++})}async function mostrarResumenProducts(){const{productos:e}=carrito,t=document.querySelector("#resumen");for(;t.firstChild;)t.removeChild(t.firstChild);if(0==carrito.productos.length){const e=document.createElement("P");return e.textContent="Falta seleccionar algun producto",e.classList.add("invalidar-carrito"),void t.appendChild(e)}const n=document.createElement("H3");n.textContent="Resumen del Carrito";const a=document.createElement("DIV");a.classList.add("resumen-Productos"),a.appendChild(n);let o=1;e.forEach(async e=>{const{id:t}=e,n=await fetch("/api/owner/inventario/"+t,{method:"GET",headers:myHeaders,redirect:"follow"}),c=await n.json(),{inventory_name:r,price:s}=c,i=document.createElement("DIV");i.classList.add("contenedor-producto");const d=document.createElement("P");d.textContent=r;const l=document.createElement("P");l.textContent="$"+s,l.classList.add("precio"),i.appendChild(d),i.appendChild(l);const u=document.createElement("div");u.classList.add("contenedor-precio");const m=document.querySelector("#quantity_product_"+o),p=document.createElement("p");p.textContent="Cantidad seleccionada: "+m.value;const h=document.createElement("p");h.textContent="Subtotal: "+s*m.value,cantidad+=s*m.value,u.appendChild(p),u.appendChild(h),a.appendChild(i),a.appendChild(u),o++});const c=pay();t.appendChild(a),t.appendChild(c),cantidad=0;const r=document.createElement("button");r.classList.add("btn-principal"),r.classList.add("btn-reservar"),r.textContent="Realizar compra",r.onclick=makeAnAppointment,t.appendChild(r)}function pay(){const e=document.createElement("P");return e.classList.add("total"),setTimeout(()=>{e.innerHTML="<span>Total a Pagar:  </span> $"+cantidad},50),e}async function makeAnAppointment(){try{console.error(cita);await fetch("/api/user/"+userId,{method:"GET",headers:myHeaders,redirect:"follow"});makeAPurcharse()}catch(e){console.log(e)}}async function makeAPurcharse(){try{console.error(carrito);await fetch("/api/user/"+userId,{method:"GET",headers:myHeaders,redirect:"follow"})}catch(e){console.log(e)}}myHeaders.append("Authorization","Bearer "+sessionStorage.getItem("token")),document.addEventListener("DOMContentLoaded",(function(){showInfoClient(),showInfoBranch(),showServices(),showInventory(),mostrarSeccion(),nextPage(),previousPage(),pagerButtons(),backDateDisabled(),horaCita(),fechaCita()}));
//# sourceMappingURL=client_services_products.js.map
